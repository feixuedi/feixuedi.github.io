<html>
<head>
  <title>18 | 深入理解StatefulSet（一）：拓扑状态</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600240 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1381"/>
<h1>18 | 深入理解StatefulSet（一）：拓扑状态</h1>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="color:rgb(51, 51, 51);font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;-ms-text-size-adjust:100%;background:rgb(255, 255, 255);-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div style="font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif;font-size-adjust:none;font-stretch:normal;"><div><div><div><div style="background:rgb(255, 255, 255);padding:30px 0px;flex-flow:row wrap;display:flex;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span><a href="https://time.geekbang.org/" style="color:rgb(229, 124, 57);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);font-size:15px;font-weight:400;">讲堂</a> <span style="font-size:10px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(204, 204, 204);margin-right:5px;"></span></span><span><a href="https://time.geekbang.org/column/116" style="color:rgb(229, 124, 57);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);font-size:15px;font-weight:400;">深入剖析Kubernetes</a> <span style="font-size:10px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(204, 204, 204);margin-right:5px;"></span></span><span><span style="color:rgb(136, 136, 136);font-size:15px;font-weight:400;">文章详情</span> </span></div> <h1 style="margin:0px;padding:0px;color:rgb(53, 53, 53);line-height:1.65rem;font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;font-size:1.34rem;font-weight:400;">
        18 | 深入理解StatefulSet（一）：拓扑状态
      </h1> <div style="color:rgb(136, 136, 136);font-size:0.93rem;margin-top:1.06rem;"><span>2018-10-03</span> <span>张磊</span></div> <div style="color:rgb(53, 53, 53);line-height:1.75rem;font-size:1rem;font-weight:400;white-space:normal;word-break:normal;margin-top:1.06rem;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/7210b6688b19700d27b2dd33302cb11a.jpg" type="image/jpeg" data-filename="7210b6688b19700d27b2dd33302cb11a.jpg" height="390" style="border:0px;border-image:none;max-width:100%;display:block;background-color:rgb(238, 238, 238);" width="696"/>  <div style="background:rgb(250, 250, 250);margin:1rem 0px;padding:1rem;border:1px solid rgb(217, 217, 217);border-image:none;width:100%;height:5.25rem;display:flex;box-sizing:border-box;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><a href="#" style="color:rgb(26, 188, 156);border-bottom-color:rgb(26, 188, 156);border-bottom-width:1px;border-bottom-style:solid;text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border:medium;border-image:none;flex-shrink:0;background-image:url(data:image/png;base64,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&quot;);background-position:0px 0px;width:2.68rem;height:2.68rem;background-repeat:no-repeat;background-size:contain;"></a> <div style="margin-left:0.68rem;display:flex;min-width:0px;flex-direction:column;flex-grow:1;-webkit-box-flex:1;-webkit-box-orient:vertical;-webkit-box-direction:normal;"><h3 style="margin:0px;padding:0px;color:rgb(53, 53, 53);line-height:1.35;font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;font-size:15.25px;font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">18 | 深入理解StatefulSet（一）：拓扑状态</h3> <p style="margin:0.12rem 0px 0px;padding:0px;color:rgb(53, 53, 53);font-weight:400;line-height:1rem;font-size:11px;"><span style="color:rgb(136, 136, 136);">朗读人：张磊   </span> <span style="color:rgb(136, 136, 136);">11′52′′ | 5.45M</span></p></div>  <span style="display:inline-block;width:100%;background-color:rgb(238, 238, 238);" title="18 | 深入理解StatefulSet（一）：拓扑状态"></span></div> <div><div><p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">你好，我是张磊。今天我和你分享的主题是：深入理解 StatefulSet 之拓扑状态。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">在上一篇文章中，我在结尾处讨论到了 Deployment 实际上并不足以覆盖所有的应用编排问题。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">造成这个问题的根本原因，在于 Deployment 对应用做了一个简单化假设。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">它认为，一个应用的所有 Pod，是完全一样的。所以，它们互相之间没有顺序，也无所谓运行在哪台宿主机上。需要的时候，Deployment 就可以通过 Pod 模板创建新的 Pod；不需要的时候，Deployment 就可以“杀掉”任意一个 Pod。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">但是，在实际的场景中，并不是所有的应用都可以满足这样的要求。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">尤其是分布式应用，它的多个实例之间，往往有依赖关系，比如：主从关系、主备关系。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">还有就是数据存储类应用，它的多个实例，往往都会在本地磁盘上保存一份数据。而这些实例一旦被杀掉，即便重建出来，实例与数据之间的对应关系也已经丢失，从而导致应用失败。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">所以，这种实例之间有不对等关系，以及实例对外部数据有依赖关系的应用，就被称为“有状态应用”（Stateful Application）。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">容器技术诞生后，大家很快发现，它用来封装“无状态应用”（Stateless Application），尤其是 Web 服务，非常好用。但是，一旦你想要用容器运行“有状态应用”，其困难程度就会直线上升。而且，这个问题解决起来，单纯依靠容器技术本身已经无能为力，这也就导致了很长一段时间内，“有状态应用”几乎成了容器技术圈子的“忌讳”，大家一听到这个词，就纷纷摇头。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">不过，Kubernetes 项目还是成为了“第一个吃螃蟹的人”。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">得益于“控制器模式”的设计思想，Kubernetes 项目很早就在 Deployment 的基础上，扩展出了对“有状态应用”的初步支持。这个编排功能，就是：StatefulSet。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">StatefulSet 的设计其实非常容易理解。它把真实世界里的应用状态，抽象为了两种情况：</p>
<ol style="margin:0px;padding:0px;list-style:decimal;margin-bottom:1rem;margin-left:1.9em;">
<li style="margin:0px;padding:0px;">
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;"><strong style="color:rgb(0, 0, 0);font-weight:500;">拓扑状态</strong>。这种情况意味着，应用的多个实例之间不是完全对等的关系。这些应用实例，必须按照某些顺序启动，比如应用的主节点 A 要先于从节点 B 启动。而如果你把 A 和 B 两个 Pod 删除掉，它们再次被创建出来时也必须严格按照这个顺序才行。并且，新创建出来的 Pod，必须和原来 Pod 的网络标识一样，这样原先的访问者才能使用同样的方法，访问到这个新 Pod。</p>
</li>
<li style="margin:0px;padding:0px;">
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;"><strong style="color:rgb(0, 0, 0);font-weight:500;">存储状态</strong>。这种情况意味着，应用的多个实例分别绑定了不同的存储数据。对于这些应用实例来说，Pod A 第一次读取到的数据，和隔了十分钟之后再次读取到的数据，应该是同一份，哪怕在此期间 Pod A 被重新创建过。这种情况最典型的例子，就是一个数据库应用的多个存储实例。</p>
</li>
</ol>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">所以，<strong style="color:rgb(0, 0, 0);font-weight:500;">StatefulSet 的核心功能，就是通过某种方式记录这些状态，然后在 Pod 被重新创建时，能够为新 Pod 恢复这些状态。</strong></p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">在开始讲述 StatefulSet 的工作原理之前，我就必须<span style="color:rgb(255, 90, 5);">先为你讲解一个 Kubernetes 项目中非常实用的概念：Headless Service。</span></p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">我在和你一起讨论 Kubernetes 架构的时候就曾介绍过，Service 是 Kubernetes 项目中用来将一组 Pod 暴露给外界访问的一种机制。比如，一个 Deployment 有 3 个 Pod，那么我就可以定义一个 Service。然后，用户只要能访问到这个 Service，它就能访问到某个具体的 Pod。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">那么，这个 Service 又是如何被访问的呢？</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;"><strong style="color:rgb(0, 0, 0);font-weight:500;">第一种方式，是以 Service 的 VIP（Virtual IP，即：虚拟 IP）方式</strong>。比如：当我访问 10.0.23.1 这个 Service 的 IP 地址时，10.0.23.1 其实就是一个 VIP，它会把请求转发到该 Service 所代理的某一个 Pod 上。这里的具体原理，我会在后续的 Service 章节中进行详细介绍。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;"><strong style="color:rgb(0, 0, 0);font-weight:500;">第二种方式，就是以 Service 的 DNS 方式</strong>。比如：这时候，只要我访问“my-svc.my-namespace.svc.cluster.local”这条 DNS 记录，就可以访问到名叫 my-svc 的 Service 所代理的某一个 Pod。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">而在第二种 Service DNS 的方式下，具体还可以分为两种处理方法：</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">第一种处理方法，是 Normal Service。这种情况下，你访问“my-svc.my-namespace.svc.cluster.local”解析到的，正是 my-svc 这个 Service 的 VIP，后面的流程就跟 VIP 方式一致了。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">而第二种处理方法，正是 Headless Service。这种情况下，你访问“my-svc.my-namespace.svc.cluster.local”解析到的，直接就是 my-svc 代理的某一个 Pod 的 IP 地址。<strong style="color:rgb(0, 0, 0);font-weight:500;">可以看到，这里的区别在于，Headless Service 不需要分配一个 VIP，而是可以直接以 DNS 记录的方式解析出被代理 Pod 的 IP 地址。</strong></p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">那么，这样的设计又有什么作用呢？</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">想要回答这个问题，我们需要从 Headless Service 的定义方式看起。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">下面是一个标准的 Headless Service 对应的 YAML 文件：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>apiVersion: v1</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>kind: Service</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>metadata:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  name: nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">5</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  labels:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">6</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>    app: nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">7</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>spec:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">8</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  ports:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">9</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  - port: 80</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">10</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>    name: web</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">11</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  clusterIP: None</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">12</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  selector:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">13</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>    app: nginx</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">可以看到，所谓的 Headless Service，其实仍是一个标准 Service 的 YAML 文件。只不过，它的 clusterIP 字段的值是：None，即：这个 Service，没有一个 VIP 作为“头”。这也就是 Headless 的含义。所以，这个 Service 被创建后并不会被分配一个 VIP，而是会以 DNS 记录的方式暴露出它所代理的 Pod。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">而它所代理的 Pod，依然是采用我在前面第 12 篇文章<a href="https://time.geekbang.org/column/article/40008" style="color:rgb(26, 188, 156);border-bottom-color:rgb(26, 188, 156);border-bottom-width:1px;border-bottom-style:solid;text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);">《牛刀小试：我的第一个容器化应用》</a>中提到的 Label Selector 机制选择出来的，即：所有携带了 app=nginx 标签的 Pod，都会被这个 Service 代理起来。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">然后关键来了。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">当你按照这样的方式创建了一个 Headless Service 之后，它所代理的所有 Pod 的 IP 地址，都会被绑定一个这样格式的 DNS 记录，如下所示：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>&lt;pod-name&gt;.&lt;svc-name&gt;.&lt;namespace&gt;.svc.cluster.local</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">这个 DNS 记录，正是 Kubernetes 项目为 Pod 分配的唯一的“可解析身份”（Resolvable Identity）。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">有了这个“可解析身份”，只要你知道了一个 Pod 的名字，以及它对应的 Service 的名字，你就可以非常确定地通过这条 DNS 记录访问到 Pod 的 IP 地址。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">那么，<span style="color:rgb(255, 90, 5);">StatefulSet 又是如何使用这个 DNS 记录来维持 Pod 的拓扑状态的呢？</span></p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">为了回答这个问题，现在我们就来编写一个 StatefulSet 的 YAML 文件，如下所示：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>apiVersion: apps/v1</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>kind: StatefulSet</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>metadata:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  name: web</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">5</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>spec:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">6</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  serviceName: &quot;nginx&quot;</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">7</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  replicas: 2</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">8</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  selector:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">9</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>    matchLabels:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">10</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>      app: nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">11</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>  template:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">12</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>    metadata:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">13</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>      labels:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">14</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>        app: nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">15</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>    spec:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">16</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>      containers:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">17</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>      - name: nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">18</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>        image: nginx:1.9.1</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">19</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>        ports:</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">20</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>        - containerPort: 80</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">21</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>          name: web</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">这个 YAML 文件，和我们在前面文章中用到的 nginx-deployment 的唯一区别，就是多了一个 serviceName=nginx 字段。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">这个字段的作用，就是告诉 StatefulSet 控制器，在执行控制循环（Control Loop）的时候，请使用 nginx 这个 Headless Service 来保证 Pod 的“可解析身份”。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">所以，当你通过 kubectl create 创建了上面这个 Service 和 StatefulSet 之后，就会看到如下两个对象：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl create -f svc.yaml</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl get service nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>NAME      TYPE         CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>nginx     ClusterIP    None         &lt;none&gt;        80/TCP    10s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">5</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div> </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">6</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl create -f statefulset.yaml</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">7</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl get statefulset web</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">8</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>NAME      DESIRED   CURRENT   AGE</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">9</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web       2         1         19s</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">这时候，如果你手比较快的话，还可以通过 kubectl 的 -w 参数，即：Watch 功能，实时查看 StatefulSet 创建两个有状态实例的过程：</p>
<blockquote style="margin:1em 3em 1em 2em;padding:0px;color:rgb(153, 153, 153);padding-left:1em;font-weight:400;border-left-color:rgb(26, 188, 156);border-left-width:1px;border-left-style:solid;position:relative;margin-bottom:1rem;">
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">备注：如果手不够快的话，Pod 很快就创建完了。不过，你依然可以通过这个 StatefulSet 的 Events 看到这些信息。</p>
</blockquote>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl get pods -w -l app=nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>NAME      READY     STATUS    RESTARTS   AGE</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-0     0/1       Pending   0          0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-0     0/1       Pending   0         0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">5</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-0     0/1       ContainerCreating   0         0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">6</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-0     1/1       Running   0         19s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">7</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1     0/1       Pending   0         0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">8</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1     0/1       Pending   0         0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">9</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1     0/1       ContainerCreating   0         0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">10</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1     1/1       Running   0         20s</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">通过上面这个 Pod 的创建过程，我们不难看到，StatefulSet 给它所管理的所有 Pod 的名字，进行了编号，编号规则是：<span>-<span>。</span></span></p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">而且这些编号都是从 0 开始累加，与 StatefulSet 的每个 Pod 实例一一对应，绝不重复。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">更重要的是，这些 Pod 的创建，也是严格按照编号顺序进行的。比如，在 web-0 进入到 Running 状态、并且细分状态（Conditions）成为 Ready 之前，web-1 会一直处于 Pending 状态。</p>
<blockquote style="margin:1em 3em 1em 2em;padding:0px;color:rgb(153, 153, 153);padding-left:1em;font-weight:400;border-left-color:rgb(26, 188, 156);border-left-width:1px;border-left-style:solid;position:relative;margin-bottom:1rem;">
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">备注：Ready 状态再一次提醒了我们，为 Pod 设置 livenessProbe 和 readinessProbe 的重要性。</p>
</blockquote>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">当这两个 Pod 都进入了 Running 状态之后，你就可以查看到它们各自唯一的“网络身份”了。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">我们使用 kubectl exec 命令进入到容器中查看它们的 hostname：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl exec web-0 -- sh -c 'hostname'</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-0</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl exec web-1 -- sh -c 'hostname'</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">可以看到，这两个 Pod 的 hostname 与 Pod 名字是一致的，都被分配了对应的编号。接下来，我们再试着以 DNS 的方式，访问一下这个 Headless Service：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl run -i --tty --image busybox dns-test --restart=Never --rm /bin/sh </div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">通过这条命令，我们启动了一个一次性的 Pod，因为–rm 意味着 Pod 退出后就会被删除掉。然后，在这个 Pod 的容器里面，我们尝试用 nslookup 命令，解析一下 Pod 对应的 Headless Service：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl run -i --tty --image busybox dns-test --restart=Never --rm /bin/sh</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ nslookup web-0.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Server:    10.0.0.10</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">5</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div> </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">6</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Name:      web-0.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">7</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.244.1.7</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">8</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div> </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">9</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ nslookup web-1.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">10</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Server:    10.0.0.10</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">11</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">12</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div> </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">13</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Name:      web-1.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">14</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.244.2.7</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">从 nslookup 命令的输出结果中，我们可以看到，在访问 web-0.nginx 的时候，最后解析到的，正是 web-0 这个 Pod 的 IP 地址；而当访问 web-1.nginx 的时候，解析到的则是 web-1 的 IP 地址。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">这时候，如果你在另外一个 Terminal 里把这两个“有状态应用”的 Pod 删掉：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl delete pod -l app=nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>pod &quot;web-0&quot; deleted</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>pod &quot;web-1&quot; deleted</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">然后，再在当前 Terminal 里 Watch 一下这两个 Pod 的状态变化，就会发现一个有趣的现象：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl get pod -w -l app=nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>NAME      READY     STATUS              RESTARTS   AGE</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-0     0/1       ContainerCreating   0          0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>NAME      READY     STATUS    RESTARTS   AGE</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">5</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-0     1/1       Running   0          2s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">6</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1     0/1       Pending   0         0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">7</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1     0/1       ContainerCreating   0         0s</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">8</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>web-1     1/1       Running   0         32s</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">可以看到，当我们把这两个 Pod 删除之后，Kubernetes 会按照原先编号的顺序，创建出了两个新的 Pod。并且，Kubernetes 依然为它们分配了与原来相同的“网络身份”：web-0.nginx 和 web-1.nginx。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">通过这种严格的对应规则，<strong style="color:rgb(0, 0, 0);font-weight:500;">StatefulSet 就保证了 Pod 网络标识的稳定性</strong>。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">比如，如果 web-0 是一个需要先启动的主节点，web-1 是一个后启动的从节点，那么只要这个 StatefulSet 不被删除，你访问 web-0.nginx 时始终都会落在主节点上，访问 web-1.nginx 时，则始终都会落在从节点上，这个关系绝对不会发生任何变化。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">所以，如果我们再用 nslookup 命令，查看一下这个新 Pod 对应的 Headless Service 的话：</p>
<pre style="margin:0px;padding:1em 1.5em;font-family:Courier,Courier New,monospace;background:hsla(0, 0%, 97%, 0.7);border:1px solid rgb(221, 221, 221);border-image:none;display:block;margin-bottom:1rem;overflow:hidden;padding-right:0px;padding-left:0px;margin-top:1rem;position:relative;"><code style="margin:0px;padding:0px;font-style:normal;font-weight:400;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;width:100%;padding-right:1rem;padding-left:1rem;font-size:0.8rem;display:block;overflow-x:auto;box-sizing:border-box;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;border-collapse:collapse;border-spacing:0px;margin-bottom:0px;box-sizing:border-box;"><tbody style="box-sizing:border-box;"><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">1</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ kubectl run -i --tty --image busybox dns-test --restart=Never --rm /bin/sh </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">2</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ nslookup web-0.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">3</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Server:    10.0.0.10</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">4</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">5</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div> </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">6</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Name:      web-0.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">7</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.244.1.8</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">8</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div> </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">9</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>$ nslookup web-1.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">10</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Server:    10.0.0.10</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">11</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.0.0.10 kube-dns.kube-system.svc.cluster.local</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">12</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div> </div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">13</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Name:      web-1.nginx</div></td></tr><tr style="box-sizing:border-box;"><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgba(27, 31, 35, 0.3);box-sizing:border-box;text-align:right;white-space:nowrap;cursor:pointer;min-width:15px;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;"><div><span style="">14</span></div></td><td style="margin:0px;padding:0px;border:0px;border-image:none;color:rgb(36, 41, 46);box-sizing:border-box;line-height:20px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;vertical-align:top;overflow:visible;padding-right:10px;padding-left:10px;white-space:pre;position:relative;word-wrap:normal;"><div>Address 1: 10.244.2.8</div></td></tr></tbody></table></code><div style="top:0.2em;right:1em;color:rgb(136, 136, 136);font-size:13px;position:absolute;cursor:pointer;-ms-user-select:none;"><span style="font-size:12px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;margin-right:0.2em;"></span>复制代码</div></pre>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">我们可以看到，在这个 StatefulSet 中，这两个新 Pod 的“网络标识”（比如：web-0.nginx 和 web-1.nginx），再次解析到了正确的 IP 地址（比如：web-0 Pod 的 IP 地址 10.244.1.8）。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">通过这种方法，<strong style="color:rgb(0, 0, 0);font-weight:500;">Kubernetes 就成功地将 Pod 的拓扑状态（比如：哪个节点先启动，哪个节点后启动），按照 Pod 的“名字 + 编号”的方式固定了下来</strong>。此外，Kubernetes 还为每一个 Pod 提供了一个固定并且唯一的访问入口，即：这个 Pod 对应的 DNS 记录。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">这些状态，在 StatefulSet 的整个生命周期里都会保持不变，绝不会因为对应 Pod 的删除或者重新创建而失效。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">不过，相信你也已经注意到了，尽管 web-0.nginx 这条记录本身不会变，但它解析到的 Pod 的 IP 地址，并不是固定的。这就意味着，对于“有状态应用”实例的访问，你必须使用 DNS 记录或者 hostname 的方式，而绝不应该直接访问这些 Pod 的 IP 地址。</p>
<h2 style="margin:0px;padding:0px;color:rgb(0, 0, 0);line-height:1.35;font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;margin-top:1.2em;margin-bottom:0.45rem;font-size:1.12rem;font-weight:500;">总结</h2>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">在今天这篇文章中，我首先和你分享了 StatefulSet 的基本概念，解释了什么是应用的“状态”。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">紧接着 ，我为你分析了 StatefulSet 如何保证应用实例之间“拓扑状态”的稳定性。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">如果用一句话来总结的话，你可以这么理解这个过程：</p>
<blockquote style="margin:1em 3em 1em 2em;padding:0px;color:rgb(153, 153, 153);padding-left:1em;font-weight:400;border-left-color:rgb(26, 188, 156);border-left-width:1px;border-left-style:solid;position:relative;margin-bottom:1rem;">
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">StatefulSet 这个控制器的主要作用之一，就是使用 Pod 模板创建 Pod 的时候，对它们进行编号，并且按照编号顺序逐一完成创建工作。而当 StatefulSet 的“控制循环”发现 Pod 的“实际状态”与“期望状态”不一致，需要新建或者删除 Pod 进行“调谐”的时候，它会严格按照这些 Pod 编号的顺序，逐一完成这些操作。</p>
</blockquote>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">所以，StatefulSet 其实可以认为是对 Deployment 的改良。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">与此同时，通过 Headless Service 的方式，StatefulSet 为每个 Pod 创建了一个固定并且稳定的 DNS 记录，来作为它的访问入口。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">实际上，在部署“有状态应用”的时候，应用的每个实例拥有唯一并且稳定的“网络标识”，是一个非常重要的假设。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">在下一篇文章中，我将会继续为你剖析 StatefulSet 如何处理存储状态。</p>
<h2 style="margin:0px;padding:0px;color:rgb(0, 0, 0);line-height:1.35;font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;margin-top:1.2em;margin-bottom:0.45rem;font-size:1.12rem;font-weight:500;">思考题</h2>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">你曾经运维过哪些有拓扑状态的应用呢（比如：主从、主主、主备、一主多从等结构）？你觉得这些应用实例之间的拓扑关系，能否借助这种为 Pod 实例编号的方式表达出来呢？如果不能，你觉得 Kubernetes 还应该为你提供哪些支持来管理这个拓扑状态呢？</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;">感谢你的收听，欢迎你给我留言，也欢迎分享给更多的朋友一起阅读。</p>
<p style="margin:0px;padding:0px;margin-bottom:1rem;color:rgb(53, 53, 53);font-weight:400;margin-top:0.15rem;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/47a6f3bf6b92d58512d5a2ed0a556f55.jpg" type="image/jpeg" data-filename="47a6f3bf6b92d58512d5a2ed0a556f55.jpg" alt="" height="344" style="border:0px;border-image:none;max-width:100%;display:block;background-color:rgb(238, 238, 238);" width="696"/></p>
</div></div> <p style="margin:0px;padding:0px;margin-bottom:30px;color:rgb(153, 153, 153);font-weight:400;margin-top:0.15rem;">
          版权归极客邦科技所有，未经许可不得转载
        </p></div> <div style="overflow:hidden;margin-bottom:-30px;"><a style="color:rgb(255, 255, 255);text-decoration:none;height:20px;text-align:center;line-height:20px;font-size:12px;display:inline-block;flex-grow:1;border-radius:3px;background-color:rgb(255, 90, 5);word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);-webkit-box-flex:1;padding:4px 8px;cursor:pointer;float:right;">写留言</a></div> <div style="margin-top:2rem;"><h2 style="margin:0px;padding:0px;color:rgb(136, 136, 136);line-height:1.35;font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;text-align:center;margin-bottom:1rem;position:relative;z-index:1;"><span style="color:rgb(136, 136, 136);line-height:1.35;font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;text-align:center;left:0px;top:56%;width:100%;border-top-color:rgb(136, 136, 136);border-top-width:1px;border-top-style:dotted;position:absolute;z-index:-1;"></span><span style="background:rgb(255, 255, 255);padding:0px 1rem;font-size:15.25px;font-weight:400;display:inline-block;">精选留言</span></h2> <ul style="margin:0px;padding:0px;list-style:none;"><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/c0128e6c.jpg" type="image/jpeg" data-filename="c0128e6c.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">Dillion</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">4</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">在上面的例子中，web-0、web-1启动后，此时如果web-0挂了，那在创建web-0的过程中，web-1也会被重新创建一次么？？？也就是如果一个StatefulSet中只有某个Pod挂了，在重启它的时候，如何确保文中说的Pod启动顺序呢？？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-03</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">任何一次pod的更新都会触发statefulset 滚动更新，更新一定会按编号顺序。但如果只是删除那就直接重建当前pod就够了，这并不破坏拓扑状态。当然，必要的时候，你的pod启动命令要能够区分第一次启动和重启，见下一节。</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-05</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/0.jpg" type="image/jpeg" data-filename="0.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">刘欣洲</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">2</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">访问不到啊<br/>/ # nslookup web-0.nginx<br/>Server:		10.96.0.10<br/>Address:	10.96.0.10:53<br/><br/>** server can't find web-0.nginx: NXDOMAIN<br/><br/>*** Can't find web-0.nginx: No answer<br/><br/>是不是需要DNS插件啊， 该如何启动呢？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-04</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">dns是默认插件。你按我前面的部署流程、也就是官方的部署流程，是必然有dns的。看看pod列表debug一下吧。</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/defaultAvatar.e4ab9fe.jpg" type="image/jpeg" data-filename="defaultAvatar.e4ab9fe.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">fldhmily63319</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">2</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">我也想问， &quot;Normal Service&quot;和&quot;Headless Service“的应用场景是什么？<br/><br/>根据文章所说的，”Headless Service不需要分配一个 VIP，而是可以直接以 DNS 记录的方式解析出被代理 Pod 的 IP 地址“，同时由于其编号的严格规定，会按照编号顺序完成创建工作。<br/><br/>这样是不是说，如果在部署StatefulSet的时候，大部分是推荐使用&quot;Headless Service&quot; ，而不是&quot;Normal Service”呢？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-03</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">是，必须用headless service</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/170654bb.jpg" type="image/jpeg" data-filename="170654bb.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">千寻</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">说dns访问不到那个童鞋，不要用latest标签的busybox，用busybox:1.28.4这个tag的就可以了，我也是这样。</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-09</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">这咋还跟镜像有关系呢？</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-09</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/132.jpg" type="image/jpeg" data-filename="132.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">along2018</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">创建statefulset必须要先创建一个headless的service?分两步操作？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-08</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">对的</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-08</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/01b2839e.jpg" type="image/jpeg" data-filename="01b2839e.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">巩夫建</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">Headless Service中不通过vip，外部访问的时候，是轮询还是随机还是热备的方式访问到web-0和web-1，dns解析好像没有轮询随机概念吧。</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-06</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">只能访问到固定的一个pod。所以说headless service不能替代normal service </p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-07</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/7f575aec.jpg" type="image/jpeg" data-filename="7f575aec.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">A-</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">每次pod被重新创建后，都能够保证原来的网络标示，那有什么办法，能够固定ip呢？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-05</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">自己编写网络插件。为什么不能用这个固定的DNS名字替代IP？</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-06</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/7f575aec [1].jpg" type="image/jpeg" data-filename="7f575aec.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">A-</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">service里的dns信息是存在etcd里的嘛？有些应用的pod的域名是自己定义的。而不是k8s创建出来的带有local的域名。我可以更改service里的dns信息嘛？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-04</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">kubernetes 当然允许你自定义域名了</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/a0966b4d.jpg" type="image/jpeg" data-filename="a0966b4d.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">Tim Zhang</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">既然默认有安装dns 为啥还要开启dns插件呢</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-04</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">因为有太多人是自己拿二进制文件DIY部署的，不按kubeadm的流程来</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/a0966b4d [1].jpg" type="image/jpeg" data-filename="a0966b4d.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">Tim Zhang</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">statefulset通过dns访问pod 是否必须要启动dns插件？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-03</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">kubernetes的dns早就已经是默认安装的了</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/132 [1].jpg" type="image/jpeg" data-filename="132.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">兽医</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">请问当需要对StatefulSet进行缩容后，再扩容到原有规模。在涉及变动的Pod中，状态也会被保持吗？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-03</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">当然</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/75875257.jpg" type="image/jpeg" data-filename="75875257.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">虎虎❤️</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">您好。滚动升级的时候，如果新的web-0和老的web-2同时ready，但新老版本不兼容怎么办？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-03</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">滚动更新的结果一定是版本一样，你说的这个状态只可能是中间状态</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/ce7f7d54.jpg" type="image/jpeg" data-filename="ce7f7d54.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">asdf100</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">1</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">那么两种service模式应用场景通常有哪些？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-03</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">service相关见后面讲解</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-03</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/c43f85d9.jpg" type="image/jpeg" data-filename="c43f85d9.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">IOVE.-Minn</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">0</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">请教张大佬，当我跑jenkins in k8s的时候是用的statefulset部署的jenkins的master，我关联的service但是却不是无头服务啊，  spec.ports 是用的nodeport  也没有用clusterIP：none这样。但是整个服务也是正常的。这不是和你讲的statefulset必须是关联headless service违背了么？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-09</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">这说明你不需要通过带编号的dns名字访问这个节点呗，没啥奇怪的</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-09</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/534db55d.jpg" type="image/jpeg" data-filename="534db55d.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">huan</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">0</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">关于nslookup无法解析的问题，debug了下dnspod的log。使用命令 `kubectl logs -f kube-dns-86f4d74b45-28xdg kubedns -n kube-system` 来监视dns pod的log。<br/>当 `kubectl delete -f svc.yaml` 的时候，会有一个log出现：<br/>`I1007 14:12:32.818523       1 dns.go:555] Could not find endpoints for service &quot;nginx&quot; in namespace &quot;default&quot;. DNS records will be created once endpoints show up.`<br/>期待这个问题会随着k8s的学习深入得到解决。<br/></div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-07</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">service部分讲解可以关注一下</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-08</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/534db55d [1].jpg" type="image/jpeg" data-filename="534db55d.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">huan</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">0</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">同楼上的问题，我这里是按照kubeadm安装的（kube-system中也添加了weave-net），但是nslookup也是报错，不知道为什么。<br/><br/>不过我在dsn-test的pod中运行 `ping web-1.nginx` 或者 `ping web-1.nginx.default.svc.cluster.local` 都是可以找得到对应的ip的。</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-06</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">看看dns pod的log？</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-07</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/defaultAvatar.e4ab9fe [1].jpg" type="image/jpeg" data-filename="defaultAvatar.e4ab9fe.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">extraterrestrial！！</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">0</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">有同样的问题，statefulset的template配置没有指定主从的选项，要怎么配置主从？ 比如配一个redis的主从？</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-06</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">看后面的实践部份</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-06</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/bde525b1.jpg" type="image/jpeg" data-filename="bde525b1.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">北卡</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">0</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">我看了网上etcd集群的yaml,确实是用脚本直接去配置pod的dns name的。</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-04</span> </div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/bde525b1 [1].jpg" type="image/jpeg" data-filename="bde525b1.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">北卡</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">0</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">有两点不太明白的，请教一下。<br/>“任何pod的变化都会触发一次statefulset的滚动更新。”<br/>这句话怎么理解呢？实际使用上，比如我用statefulset创建了一个3个pod的etcd集群，我删掉etcd-1,etcd-1会马上重新启动，但etcd-0和etcd-2并不会被删掉重建啊。<br/><br/>headless server是不是只适合于这种用来做集群节点的发现使用，不适合像service那样用来开放服务访问？<br/>用nslookup来查看headless server, nslookup etcd, 会返回3个对应pod的ip地址， 但直接去ping etcd的话，每次都会返回同一个pod的ip地址，其他两个地址永远不会被ping到。<br/>那我建立集群的时候，去发现节点的ip时，是不是就不能直接简单配置为etcd了呢，而要配置etcd-0.etcd, etcd-1.etcd这样每个都去配置呢？<br/><br/></div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-04</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">具体更新哪个pod，控制循环会决定。如果只是删除操作，那肯定重建当前的pod就够了。但你的pod的启动命令要需要区分第一次启动和重启，下一节会讲。这就是headless service跟normal service的不同。所以你必然要用etcd-0.etcd。</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-05</p></div></div></li><li style="margin:0px;padding:0px;width:100%;margin-bottom:1rem;display:flex;list-style-position:inside;flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><img src="18  深入理解StatefulSet（一）：拓扑状态_files/164b9073.jpg" type="image/jpeg" data-filename="164b9073.jpg" height="42" style="border:0px;border-image:none;border-radius:50%;width:2.62rem;height:2.62rem;flex-shrink:0;" width="42"/> <div style="margin-left:0.5rem;flex-grow:1;-webkit-box-flex:1;"><div style="width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:center;-webkit-box-align:center;-webkit-box-pack:justify;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><span style="color:rgb(136, 136, 136);line-height:1.2;font-size:15.25px;font-weight:400;">Majorin_Che</span> <div style="display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"> <a href="#" style="color:rgb(26, 188, 156);text-decoration:none;word-wrap:break-word;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);border-bottom-color:currentColor;border-bottom-width:medium;border-bottom-style:none;font-size:15.25px;display:flex;flex-direction:row;align-items:center;-webkit-box-align:center;-webkit-box-orient:horizontal;-webkit-box-direction:normal;"><i style="font-size:0.75rem;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(136, 136, 136);margin-top:-0.01rem;margin-right:0.3rem;display:inline-block;"></i> <span style="color:rgb(255, 90, 5);">0</span></a></div></div> <div style="color:rgb(53, 53, 53);line-height:1.6;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">headless根据label选择pod，那如果另外一个namespace的某个pod有相同的label，会不会被选中</div> <span style="color:rgb(136, 136, 136);line-height:1;font-size:9px;">2018-10-04</span> <div><div style="font-size:15.25px;"><i style="font-size:15.25px;font-style:normal;-webkit-text-stroke-width:0.2px;font-family:iconfont;color:rgb(255, 90, 5);"></i> <span style="color:rgb(136, 136, 136);font-weight:400;margin-left:-12px;">作者回复</span></div> <p style="margin:0px;padding:0px;color:rgb(53, 53, 53);font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;">namespace也不是形同虚设啊</p> <p style="margin:0px;padding:0px;color:rgb(136, 136, 136);font-size:9px;">2018-10-04</p></div></div></li></ul></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 